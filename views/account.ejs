<!doctype html>
<html lang="en">
<head>
  <%- include('./partials/head', { pageTitle: 'Your Account • BookLantern' }) %>
</head>
<body>
  <%- include('./partials/navbar') %>

  <main class="stack" style="--gap:20px; max-width:880px; margin:40px auto; padding:0 16px;">
    <h1>Your Account</h1>

    <div id="accountCard" class="card stack" style="--gap:12px; padding:16px;">
      <div class="ink-2">Loading your profile…</div>
    </div>

    <div class="row" style="gap:10px;">
      <button id="signOut" class="btn">Sign out</button>
    </div>
  </main>

  <%- include('./partials/footer') %>

  <script>
  (async function(){
    const sb = window.supabaseClient;
    const card = document.getElementById('accountCard');

    function renderError(text){
      card.innerHTML = '<div class="ink-2">' + (text || 'Could not load your account details.') + '</div>';
    }

    try{
      const { data: { user }, error } = await sb.auth.getUser();
      if (error || !user) return renderError();

      const email = user.email || '(no email)';
      const name = (user.user_metadata && (user.user_metadata.full_name || user.user_metadata.name)) || '(no name)';
      const role = (user.app_metadata && user.app_metadata.role) || 'subscriber';

      card.innerHTML = `
        <div><strong>Name:</strong> ${name}</div>
        <div><strong>Email:</strong> ${email}</div>
        <div><strong>Role:</strong> ${role}</div>
      `;
    }catch(e){
      renderError();
    }

    document.getElementById('signOut').addEventListener('click', async ()=>{
      await sb.auth.signOut();
      location.href = '/';
    });
  })();
  </script>
</body>
</html>
