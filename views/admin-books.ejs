<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>
    <%= (typeof pageTitle !== 'undefined' ? pageTitle
         : (typeof title !== 'undefined' ? title : 'Admin • Books')) %>
  </title>
  <link rel="stylesheet" href="/public/css/site.css?v=<%= (buildId || Date.now()) %>">
  <link rel="stylesheet" href="/public/css/nav.css?v=<%= (buildId || Date.now()) %>">
  <link rel="stylesheet" href="/public/css/hero.css?v=<%= (buildId || Date.now()) %>">
  <link rel="stylesheet" href="/public/css/carousel.css?v=<%= (buildId || Date.now()) %>">
  <link rel="stylesheet" href="/public/css/footer.css?v=<%= (buildId || Date.now()) %>">
</head>
<body class="admin">

  <main class="container narrow">
    <h1>Admin • Books</h1>

    <% if (typeof error !== 'undefined' && error) { %>
      <p class="banner error"><%= error %></p>
    <% } %>
    <% if (typeof success !== 'undefined' && success) { %>
      <p class="banner success"><%= success %></p>
    <% } %>

    <div class="grid two">
      <section class="card">
        <h3>Add a book</h3>
        <form method="post" action="/admin/books">
          <label>Title
            <input type="text" name="title" placeholder="Title" required />
          </label>

          <label>Author
            <input type="text" name="author" placeholder="Author" />
          </label>

          <label>Genre / Shelf
            <select name="genre_slug" required>
              <option value="" disabled selected>Select a shelf…</option>
              <% (genres || []).forEach(g => { %>
                <option value="<%= g.slug %>">
                  <%= g.name %><%= (g.homepage_row ? ' — row ' + g.homepage_row : '') %>
                </option>
              <% }) %>
            </select>
          </label>

          <label>Cover URL
            <input type="url" name="cover" placeholder="https://…" />
          </label>

          <label>Source URL (preferred)
            <input type="url" name="source_url" placeholder="https://archive.org/… or https://…/book/…" />
          </label>

          <div class="grid two">
            <label>Provider (e.g. gutenberg)
              <input type="text" name="provider" placeholder="gutenberg" />
            </label>
            <label>Provider ID
              <input type="text" name="provider_id" placeholder="1342" />
            </label>
          </div>

          <button class="btn" type="submit">Save</button>
        </form>
      </section>

      <aside class="card">
        <h3>How this works</h3>
        <p>This page posts to <code>/admin/books</code>, then lists below from <code>curated_books</code>. Select a shelf and the homepage knows which row to place it on.</p>
      </aside>
    </div>

    <section class="card">
      <h2>Books</h2>
      <% if (!books || books.length === 0) { %>
        <p>No books yet.</p>
      <% } else { %>
        <ul class="unstyled">
          <% books.forEach(b => { %>
            <li>
              <strong><%= b.title %></strong>
              <% if (b.author) { %> by <%= b.author %><% } %>
              — <em><%= (b.book_genres && b.book_genres.name) ? b.book_genres.name : (b.genre_slug || '') %></em>
              <% if (b.source_url) { %> • <a href="<%= b.source_url %>" target="_blank" rel="noopener">source</a><% } %>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </section>
  </main>

  <script src="/public/js/theme.js?v=<%= (buildId || Date.now()) %>"></script>
</body>
</html>
