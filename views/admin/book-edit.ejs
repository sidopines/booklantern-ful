<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head'); %>
  <title>Admin • Edit book</title>
  <style>
    .admin-wrap{max-width:980px;margin:24px auto 64px;}
    .card{border:1px solid #eee;border-radius:12px;padding:16px;background:#fff}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .row .grow{flex:1}
    .input, textarea, select{width:100%}
    .btn{display:inline-block;border:1px solid #ddd;border-radius:8px;padding:8px 12px;background:#fafafa}
    .btn.primary{background:#101010;color:#fff;border-color:#101010}
    .note.err{background:#fff1f2;border:1px solid #fecaca;color:#9f1239;padding:8px 10px;border-radius:8px}
    .note.ok{background:#f0fdf4;border:1px solid #bbf7d0;color:#065f46;padding:8px 10px;border-radius:8px}
    a.link{color:#222;text-decoration:underline}
  </style>
</head>
<body>
  <%- include('../partials/header'); %>

  <main class="admin-wrap">
    <a class="link" href="/admin/books">← Back to books</a>
    <h1 style="margin-bottom:8px;">Edit book</h1>

    <% if (messages && messages.error) { %>
      <p class="note err"><%= messages.error %></p>
    <% } %>
    <% if (messages && messages.success) { %>
      <p class="note ok"><%= messages.success %></p>
    <% } %>

    <section class="card">
      <form method="POST" action="/admin/books/update">
        <!-- SINGLE source of truth for id -->
        <input type="hidden" name="id" value="<%= book.id %>">

        <div class="row">
          <label class="grow">Title
            <input class="input" type="text" name="title" value="<%- book.title || '' %>" required>
          </label>
        </div>

        <div class="row">
          <label class="grow">Author
            <input class="input" type="text" name="author" value="<%- book.author || '' %>">
          </label>
        </div>

        <div class="row">
          <label class="grow">Genre / Shelf
            <select class="input" name="genre_slug" required>
              <% (genres || []).forEach(function(g){ %>
                <option value="<%= g.slug %>" <%= (book.genre_slug === g.slug ? 'selected' : '') %>><%= g.name %></option>
              <% }) %>
            </select>
          </label>
        </div>

        <div class="row">
          <label class="grow">Cover URL
            <input class="input" type="url" name="cover" value="<%- book.cover || '' %>" placeholder="https://…/cover.jpg">
          </label>
        </div>

        <div class="row">
          <label class="grow">Source URL (preferred)
            <input class="input" type="url" name="source_url" value="<%- book.source_url || '' %>" placeholder="https://…">
          </label>
        </div>

        <div class="row">
          <label class="grow">OR Provider (e.g. gutenberg)
            <input class="input" type="text" name="provider" value="<%- book.provider || '' %>" placeholder="gutenberg">
          </label>
          <label class="grow">Provider ID
            <input class="input" type="text" name="provider_id" value="<%- book.provider_id || '' %>" placeholder="1342">
          </label>
        </div>

        <div class="row" style="margin-top:8px;">
          <button class="btn primary" type="submit">Update</button>
          <a class="btn" href="/admin/books">Cancel</a>
        </div>
      </form>
    </section>
  </main>

  <%- include('../partials/footer'); %>
</body>
</html>
