<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head'); %>
  <title>Admin • Books</title>
  <style>
    .admin-wrap{max-width:980px;margin:24px auto 64px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .card{border:1px solid #eee;border-radius:12px;padding:16px;background:#fff}
    .muted{color:#666;font-size:14px}
    .tbl{width:100%;border-collapse:collapse;margin-top:12px}
    .tbl th,.tbl td{border-bottom:1px solid #eee;padding:8px 6px;text-align:left}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .row .grow{flex:1}
    .input, textarea, select{width:100%}
    .btn{display:inline-block;border:1px solid #ddd;border-radius:8px;padding:8px 12px;background:#fafafa}
    .btn.danger{border-color:#f3d2d2;background:#fff3f3;color:#a00}
    .select, .input{border:1px solid #ddd;border-radius:8px;padding:8px 10px}
    .note{background:#fff9e6;border:1px solid #ffe7a3;padding:8px 10px;border-radius:8px}
    .note.ok{background:#f0fdf4;border-color:#bbf7d0;color:#065f46}
    .note.err{background:#fff1f2;border-color:#fecaca;color:#9f1239}
  </style>
</head>
<body>
  <%- include('../partials/header'); %>

  <main class="admin-wrap">
    <h1>Admin • Books</h1>

    <% if (messages && messages.error) { %>
      <p class="note err"><%= messages.error %></p>
    <% } %>
    <% if (messages && messages.success) { %>
      <p class="note ok"><%= messages.success %></p>
    <% } %>

    <div class="grid">
      <!-- Create -->
      <section class="card">
        <h2 style="margin-top:0;">Add a book</h2>
        <form method="POST" action="/admin/books" enctype="application/x-www-form-urlencoded">
          <div class="row">
            <label class="grow">Title
              <input class="input" type="text" name="title" required>
            </label>
          </div>

          <div class="row">
            <label class="grow">Author
              <input class="input" type="text" name="author">
            </label>
          </div>

          <div class="row">
            <label class="grow">Genre / Shelf
              <select class="select" name="category" required>
                <% (categories || []).forEach(function(cat){ %>
                  <option value="<%= String(cat).toLowerCase() %>"><%= cat %></option>
                <% }) %>
              </select>
            </label>
          </div>

          <div class="row">
            <label class="grow">Cover URL
              <input class="input" type="url" name="coverImage" placeholder="https://…/cover.jpg">
            </label>
          </div>

          <div class="row">
            <label class="grow">Source URL (preferred)
              <input class="input" type="url" name="sourceUrl" placeholder="https://…">
            </label>
          </div>

          <div class="row">
            <label class="grow">OR Provider (e.g. gutenberg)
              <input class="input" type="text" name="provider" placeholder="gutenberg">
            </label>
            <label class="grow">Provider ID
              <input class="input" type="text" name="provider_id" placeholder="1342">
            </label>
          </div>

          <div class="row">
            <button class="btn" type="submit">Save</button>
          </div>
        </form>
      </section>

      <!-- Help -->
      <aside class="card">
        <h2 style="margin-top:0;">How this works</h2>
        <p class="muted">
          This page pairs with <code>routes/admin-books.js</code>. It posts to
          <code>POST /admin/books</code> and shows a list below from
          <code>GET /admin/books</code>.
        </p>
        <p class="muted">
          Select a <strong>Genre / Shelf</strong> so the book appears in the right shelf on the homepage.
        </p>
      </aside>
    </div>

    <section class="card" style="margin-top:16px;">
      <h2 style="margin-top:0;">Books</h2>
      <%
        const LIST = Array.isArray(books) ? books : [];
        if (!LIST.length) { %>
        <p class="muted">No books yet.</p>
      <% } else { %>
        <table class="tbl">
          <thead>
            <tr>
              <th>Title</th>
              <th>Author</th>
              <th>Genre</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
          <% LIST.forEach(function(b){ %>
            <tr>
              <td><%= b.title %></td>
              <td><%= b.author || '' %></td>
              <td><%= b.category || '' %></td>
              <td>
                <form method="POST" action="/admin/books/delete" style="display:inline;">
                  <input type="hidden" name="id" value="<%= b.id %>">
                  <button class="btn danger" type="submit" onclick="return confirm('Delete this book?')">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
          </tbody>
        </table>
      <% } %>
    </section>
  </main>

  <%- include('../partials/footer'); %>
</body>
</html>
