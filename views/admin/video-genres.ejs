<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head.ejs', {
    pageTitle: 'Admin • Video Genres',
    pageDescription: 'Create, rename, and delete genres used to filter videos.'
  }) %>
  <style>
    :root { --bg:#f6f7fb; --text:#111; --muted:#667085; --card:#ffffff; --border:#e5e7eb; --brand:#111; --brandHover:#333; --danger:#b42318; }
    *{ box-sizing:border-box; }
    body{ margin:0; background:var(--bg); color:var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    main{ max-width: 900px; margin: 2rem auto 3rem; padding: 0 1rem; }

    .crumbs{ display:flex; gap:.5rem; align-items:center; margin-bottom:1rem; }
    .crumbs a{ color:#1256b3; text-decoration:none; font-size:.95rem; }
    .crumbs a:hover{ text-decoration:underline; }
    h1{ margin:0 0 1rem 0; font-size: clamp(1.6rem, 2.5vw, 2rem); }

    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 820px){ .grid{ grid-template-columns: 1fr; } }

    .card{ background:#fff; border:1px solid var(--border); border-radius:14px; padding:16px; box-shadow:0 8px 28px rgba(0,0,0,.06); }
    .card h2{ margin:0 0 .5rem 0; font-size:1.1rem; }
    .muted{ color:var(--muted); }

    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    input[type="text"]{
      flex:1 1 220px; min-width:220px; padding:.6rem .7rem; border:1px solid var(--border); border-radius:10px; background:#fff;
    }
    .btn{ padding:.6rem .9rem; border:1px solid var(--border); border-radius:10px; background:#111; color:#fff; font-weight:600; cursor:pointer; text-decoration:none; }
    .btn:hover{ background:#333; }
    .btn.outline{ background:#fff; color:#111; }
    .btn.danger{ background:var(--danger); border-color:#fca5a5; }
    .btn.small{ padding:.45rem .7rem; border-radius:8px; font-size:.9rem; }

    table{ width:100%; border-collapse:collapse; }
    th, td{ padding:.55rem .6rem; border-bottom:1px solid var(--border); text-align:left; }
    th{ color:#475569; font-size:.9rem; }
    td form{ display:inline-flex; gap:6px; align-items:center; }
  </style>
</head>
<body>
  <%- include('../partials/navbar.ejs') %>
  <main>
    <div class="crumbs">
      <a href="/admin">← Admin</a>
      <span style="color:#94a3b8">/</span>
      <span>Video Genres</span>
    </div>

    <h1>Video Genres</h1>

    <% if (err) { %>
      <div class="card" style="border-color:#fecaca;background:#fff1f2;color:#9f1239;margin-bottom:12px;">⚠️ <%= err %></div>
    <% } %>
    <% if (ok && !err) { %>
      <div class="card" style="border-color:#bbf7d0;background:#f0fdf4;color:#065f46;margin-bottom:12px;">✅ Loaded.</div>
    <% } %>

    <div class="grid">
      <!-- Add -->
      <section class="card">
        <h2>Add Genre</h2>
        <form class="row" method="POST" action="/admin/genres">
          <input type="text" name="name" placeholder="e.g., Interviews" required>
          <button class="btn" type="submit">Add</button>
        </form>
        <p class="muted" style="margin-top:8px;">Simple one-word or two-word names work best.</p>
      </section>

      <!-- List -->
      <section class="card">
        <h2>Existing Genres</h2>
        <% if (!genres || !genres.length) { %>
          <p class="muted">No genres yet.</p>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th style="width:110px;">Used by</th>
                <th style="width:250px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% genres.forEach(function(g){ %>
                <tr>
                  <td><%= g.name %></td>
                  <td><%= g.usage %> video<%= g.usage === 1 ? '' : 's' %></td>
                  <td>
                    <form method="POST" action="/admin/genres/<%= g.id %>/rename" style="margin-right:8px;">
                      <input type="text" name="name" value="<%= g.name %>" required>
                      <button class="btn small" type="submit">Rename</button>
                    </form>
                    <form method="POST" action="/admin/genres/<%= g.id %>/delete" onsubmit="return confirm('Delete “<%= g.name %>”? This removes its tags from videos.');">
                      <button class="btn small danger" type="submit">Delete</button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </section>
    </div>

    <div style="margin-top:16px;">
      <a href="/admin" class="btn outline">← Back to Admin</a>
    </div>
  </main>
</body>
</html>
