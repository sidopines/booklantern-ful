<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/header'); %>
  <title>Manage Videos â€¢ Admin</title>
</head>
<body>
  <%- include('../partials/navbar'); %>

  <main class="container" style="padding:24px 0 64px;">
    <h1 class="page-title">Manage Videos</h1>

    <% if (messages && messages.success) { %>
      <div style="background:#ecfdf5;border:1px solid #10b98133;color:#047857;padding:10px 12px;border-radius:10px;margin:12px 0">
        <%= messages.success %>
      </div>
    <% } %>
    <% if (messages && messages.error) { %>
      <div style="background:#fef2f2;border:1px solid #ef444433;color:#b91c1c;padding:10px 12px;border-radius:10px;margin:12px 0">
        <%= messages.error %>
      </div>
    <% } %>

    <section class="card" style="padding:16px;border:1px solid #eee;border-radius:12px;background:#fff;margin-bottom:20px;">
      <h2 style="margin:0 0 10px;">Add Video</h2>
      <form method="POST" action="/admin/videos" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
        <input type="hidden" name="_csrf" value="<%= csrfToken || '' %>">
        <input class="input" type="text" name="title" placeholder="Great talk on books" required>
        <input class="input" type="text" name="channel" placeholder="Channel/Source (optional)">
        <input class="input" type="url" name="url" placeholder="https://www.youtube.com/watch?v=..." required style="grid-column:1/3">
        <textarea class="input" name="thumbnail" placeholder="Thumbnail URL (optional)" style="height:44px;grid-column:1/3"></textarea>

        <div style="grid-column:1/3;display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div>
            <label class="label">Genres (multi-select)</label>
            <select name="genres" multiple size="8" class="input" style="height:auto;width:100%;">
              <% (Array.isArray(genres)?genres:[]).forEach(function(g){ %>
                <option value="<%= g.id %>"><%= g.name %></option>
              <% }) %>
            </select>
            <div class="muted" style="font-size:12px;margin-top:6px">Hold Cmd/Ctrl to select multiple.</div>
          </div>
          <div>
            <label class="label">Add new genres (comma-separated)</label>
            <input class="input" type="text" name="newGenres" placeholder="History, Peace, Science">
            <div class="muted" style="font-size:12px;margin-top:6px">New names will be created and tagged to this video.</div>
          </div>
        </div>

        <div style="grid-column:1/3;text-align:right;">
          <button type="submit" class="btn btn-primary">Add Video</button>
          <a href="/admin" class="btn" style="margin-left:6px">Back to Admin</a>
        </div>
      </form>
    </section>

    <section class="card" style="padding:16px;border:1px solid #eee;border-radius:12px;background:#fff;">
      <h2 style="margin:0 0 10px;">Current Videos</h2>
      <table style="width:100%;border-collapse:collapse;">
        <thead>
          <tr>
            <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Title</th>
            <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">URL</th>
            <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Channel</th>
            <th style="text-align:center;padding:8px;border-bottom:1px solid #eee;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% (Array.isArray(videos)?videos:[]).forEach(function(v){ %>
            <tr>
              <td style="padding:8px;border-bottom:1px solid #f2f2f2;"><%= v.title %></td>
              <td style="padding:8px;border-bottom:1px solid #f2f2f2;max-width:380px;word-break:break-all;">
                <a href="<%= v.url %>" target="_blank" rel="noopener"><%= v.url %></a>
              </td>
              <td style="padding:8px;border-bottom:1px solid #f2f2f2;"><%= v.channel || '' %></td>
              <td style="padding:8px;border-bottom:1px solid #f2f2f2;text-align:center;">
                <form method="POST" action="/admin/videos/delete" onsubmit="return confirm('Delete this video?')">
                  <input type="hidden" name="id" value="<%= v.id %>">
                  <button type="submit" class="btn danger">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
          <% if (!(Array.isArray(videos) && videos.length)) { %>
            <tr><td colspan="4" style="padding:12px;text-align:center;color:#6b7280">No videos yet.</td></tr>
          <% } %>
        </tbody>
      </table>
    </section>
  </main>

  <%- include('../partials/footer'); %>
</body>
</html>
