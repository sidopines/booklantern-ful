<%- include('../partials/head', { pageTitle: 'Manage Videos - BookLantern' }) %>
<body>
  <%- include('../partials/navbar') %>

  <main class="container page-pad">
    <h1 style="font-weight:800;margin-bottom:16px">Manage Videos</h1>
    <p class="muted" style="margin-bottom:16px;">Add or remove items for the Watch page.</p>

    <% if (messages && messages.success) { %>
      <div class="alert success"><%= messages.success %></div>
    <% } %>
    <% if (messages && messages.error) { %>
      <div class="alert error"><%= messages.error %></div>
    <% } %>

    <form class="card" action="/admin/videos" method="post" style="padding:16px;margin-bottom:24px;">
      <!-- If you set ADMIN_UI_TOKEN, keep it sticky in the URL and post body -->
      <% if (typeof query !== 'undefined' && query.key) { %>
        <input type="hidden" name="key" value="<%= query.key %>">
      <% } %>
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">

      <div class="row" style="gap:16px;">
        <div class="field" style="flex:1">
          <label>Title</label>
          <input name="title" type="text" placeholder="Great talk on books" required>
        </div>
        <div class="field" style="flex:1">
          <label>URL (YouTube/Vimeo)</label>
          <input name="url" type="url" placeholder="https://www.youtube.com/watch?v=..." required>
        </div>
      </div>

      <div class="row" style="gap:16px;margin-top:12px;">
        <div class="field" style="flex:1">
          <label>Channel/Source (optional)</label>
          <input name="channel" type="text" placeholder="TEDx / Library of Congress">
        </div>
        <div class="field" style="flex:1">
          <label>Thumbnail URL (optional)</label>
          <input name="thumbnail" type="url" placeholder="https://i.ytimg.com/vi/ID/hqdefault.jpg">
        </div>
      </div>

      <div class="row" style="gap:16px;margin-top:12px;">
        <div class="field" style="flex:1">
          <label>Genres (multi-select)</label>
          <select name="genres" multiple size="4" style="width:100%;padding:8px;border:1px solid #e5e7eb;border-radius:8px;">
            <% (Array.isArray(genres)?genres:[]).forEach(g => { %>
              <option value="<%= g.name %>"><%= g.name %></option>
            <% }) %>
          </select>
          <div class="muted" style="font-size:12px;margin-top:6px;">Hold Cmd/Ctrl to select multiple. You can also add new names below.</div>
        </div>
        <div class="field" style="flex:1">
          <label>Add new genres (comma-separated)</label>
          <input name="genre_names" type="text" placeholder="interviews, author talks, literature">
        </div>
      </div>

      <button class="btn primary" type="submit" style="margin-top:12px;">Add Video</button>
    </form>

    <h2 style="font-weight:700;margin-bottom:12px;">Current Videos</h2>
    <% if (videos && videos.length) { %>
      <table class="card" style="width:100%;border-collapse:collapse;">
        <thead>
          <tr>
            <th style="text-align:left;padding:8px;">Title</th>
            <th style="text-align:left;padding:8px;">URL</th>
            <th style="text-align:left;padding:8px;">Genres</th>
            <th style="text-align:center;padding:8px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% videos.forEach((v) => { %>
            <tr>
              <td style="padding:8px;"><%= v.title %></td>
              <td style="padding:8px;"><a href="<%= v.url %>" target="_blank" rel="noopener"><%= v.url %></a></td>
              <td style="padding:8px;">
                <% if (v.genres && v.genres.length) { %>
                  <%= v.genres.join(', ') %>
                <% } else { %>
                  <span class="muted">â€”</span>
                <% } %>
              </td>
              <td style="padding:8px;text-align:center;">
                <form action="/admin/videos/delete" method="post" style="display:inline;">
                  <% if (typeof query !== 'undefined' && query.key) { %>
                    <input type="hidden" name="key" value="<%= query.key %>">
                  <% } %>
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <input type="hidden" name="id" value="<%= v.id %>">
                  <button class="btn" type="submit" onclick="return confirm('Delete this video?')">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <div class="card">No videos yet.</div>
    <% } %>
  </main>

  <%- include('../partials/footer') %>
</body>
</html>
