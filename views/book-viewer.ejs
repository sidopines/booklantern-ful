<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head.ejs', {
    pageTitle: typeof pageTitle !== 'undefined' ? pageTitle : (book && book.title ? (book.title + ' | Reader') : 'Reader'),
    pageDescription: typeof pageDescription !== 'undefined' ? pageDescription : 'Read in BookLantern'
  }) %>
  <style>
    :root { --line:#e5e7eb; }
    * { box-sizing:border-box; }
    html, body { margin:0; padding:0; height:100%; }
    body { background:#f6f7fb; color:#111; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    header.reader-bar{
      position: sticky; top:0; z-index:20;
      background:#fff; border-bottom:1px solid var(--line);
    }
    .reader-bar-inner{
      max-width:1100px; margin:0 auto; padding:.6rem 1rem;
      display:flex; align-items:center; justify-content:space-between; gap:.75rem;
    }
    .brand-link{ text-decoration:none; color:#111; font-weight:800; letter-spacing:-.01em; display:flex; align-items:center; gap:.5rem; }
    .brand-link img{ width:20px; height:20px; }
    .controls{ display:flex; gap:.5rem; align-items:center; }
    .btn{ padding:.5rem .7rem; border:1px solid var(--line); background:#fff; border-radius:10px; cursor:pointer; font-weight:600; text-decoration:none; color:#111; }
    .btn:hover{ background:#f5f7fb; }
    .guard{
      max-width:700px; margin:3rem auto; background:#fff; border:1px solid var(--line); border-radius:14px; box-shadow:0 10px 30px rgba(2,6,23,.08);
      padding:1.25rem;
    }
    .guard h1{ margin:.2rem 0 .6rem; font-size:1.4rem; }
    .guard p{ color:#667085; }
    .split{ display:flex; gap:10px; flex-wrap:wrap; margin-top:.6rem; }
    .btn.brand{ background:#111; color:#fff; border-color:#111; }
    .frame-wrap{ height:calc(100vh - 58px); }
    iframe.viewer{ border:0; width:100%; height:100%; background:#fff; }
  </style>
</head>
<body>
  <% if (!user) { %>
    <%- include('./partials/navbar.ejs') %>
    <main class="container">
      <div class="guard">
        <h1>Sign in to read</h1>
        <p>Create a free account to open this book in the reader.</p>
        <div class="split">
          <a class="btn brand" href="/login?next=<%= encodeURIComponent(req.originalUrl) %>">Login</a>
          <a class="btn" href="/register?next=<%= encodeURIComponent(req.originalUrl) %>">Create account</a>
        </div>
      </div>
    </main>
  <% } else { %>
    <header class="reader-bar">
      <div class="reader-bar-inner">
        <a class="brand-link" href="/">
          <img src="/img/brand.svg" alt="">
          BookLantern
        </a>
        <div class="controls">
          <a class="btn" href="javascript:history.back()">‚Üê Back</a>
          <a class="btn" href="/read">All Books</a>
        </div>
      </div>
    </header>

    <div class="frame-wrap">
      <% 
        const ia = book && (book.archiveId || book.identifier || '');
        const safeId = ia ? String(ia) : '';
        const stream = safeId ? `https://archive.org/stream/${encodeURIComponent(safeId)}?ui=embed#page=1` : 'about:blank';
      %>
      <iframe
        class="viewer"
        src="<%= stream %>"
        referrerpolicy="no-referrer"
        allow="clipboard-read; clipboard-write"
        title="<%= book && book.title ? book.title : 'Book' %>">
      </iframe>
    </div>
  <% } %>
</body>
</html>
