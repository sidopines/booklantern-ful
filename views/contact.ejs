<!doctype html>
<html lang="en">
<head>
  <%- include('./partials/head', {
    pageTitle: 'Contact • BookLantern',
    pageDescription: 'Send questions or feedback any time.',
    canonicalUrl: (typeof canonicalUrl !== 'undefined' ? canonicalUrl : '')
  }) %>
</head>
<body>
  <%- include('./partials/navbar') %>

  <main class="container" style="max-width: 980px; margin: 32px auto; padding: 0 16px;">
    <a href="javascript:history.back()" class="row" style="gap:6px; text-decoration:none; color:var(--ink-2); margin-bottom:14px;">← Back</a>

    <h1 style="margin: 0 0 10px 0;">Contact Us</h1>
    <p style="margin:0 0 24px 0; color: var(--ink-2);">We’d love to hear from you. Send questions or feedback any time.</p>

    <form id="contactForm" class="stack" style="--gap:14px; max-width: 720px;" method="post" action="/api/contact">
      <label class="stack" style="--gap:8px;">
        <span>Your Name</span>
        <input class="input" name="name" type="text" placeholder="Your name" required>
      </label>

      <label class="stack" style="--gap:8px;">
        <span>Your Email</span>
        <input class="input" name="email" type="email" placeholder="you@example.com" required>
      </label>

      <label class="stack" style="--gap:8px;">
        <span>Your Message</span>
        <textarea class="input" name="message" placeholder="Write your message…" rows="6" required></textarea>
      </label>

      <button class="btn btn-primary" type="submit" style="width: fit-content;">Send Message</button>
    </form>
  </main>

  <%- include('./partials/footer') %>

  <script>
    (function () {
      var form = document.getElementById('contactForm');
      if (!form) return;

      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        const fd = new FormData(form);
        const payload = {
          name: fd.get('name')?.toString().trim(),
          email: fd.get('email')?.toString().trim(),
          message: fd.get('message')?.toString().trim()
        };

        if (!payload.name || !payload.email || !payload.message) {
          return alert('Please fill out all fields.');
        }

        const res = await fetch('/api/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          form.reset();
          toast('Thanks! Your message has been sent.');
        } else {
          const t = await res.text();
          toast('Sorry, something went wrong: ' + t, true);
        }
      });

      function toast(msg, danger){
        const el = document.createElement('div');
        el.textContent = msg;
        Object.assign(el.style, {
          position:'fixed', right:'16px', bottom:'16px',
          padding:'10px 12px', borderRadius:'12px',
          background: danger ? 'rgba(220,68,68,.92)' : 'rgba(0,0,0,.78)',
          color:'#fff', zIndex:9999, boxShadow:'0 8px 28px rgba(0,0,0,.25)'
        });
        document.body.appendChild(el);
        setTimeout(()=> el.remove(), 2200);
      }
    })();
  </script>
</body>
</html>
