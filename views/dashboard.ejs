<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <%- include('./partials/head', { pageTitle: 'Your Library - BookLantern' }) %>
</head>
<body>
  <%- include('./partials/navbar') %>

  <main class="container stack" style="--gap:20px; padding:24px 16px; max-width:1100px;">
    <header class="stack" style="--gap:8px;">
      <h1>Your Library</h1>
      <p class="muted">Signed in as <strong><%= user?.email %></strong>.</p>
      <% if (typeof error !== 'undefined' && error) { %>
        <p class="alert error"><%= error %></p>
      <% } %>
    </header>

    <!-- Saves -->
    <section class="stack" style="--gap:12px;">
      <h2>Saved Books</h2>
      <% if (!saves || !saves.length) { %>
        <div class="card" style="padding:16px;">No saved books yet.</div>
      <% } else { %>
        <div class="grid books">
          <% saves.forEach(s => { %>
            <article class="card book">
              <a class="cover" href="/read/<%= s.provider %>/<%= s.book_id %>">
                <% if (s.cover) { %>
                  <img src="<%= s.cover %>" alt="<%= s.title || 'Book cover' %>">
                <% } else { %>
                  <div class="cover ph">No cover</div>
                <% } %>
              </a>
              <div class="meta">
                <h3 class="title"><a href="/read/<%= s.provider %>/<%= s.book_id %>"><%= s.title || (s.provider + ':' + s.book_id) %></a></h3>
                <% if (s.author) { %><p class="author"><%= s.author %></p><% } %>
                <form method="post" action="/library/saves/delete" class="inline">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <input type="hidden" name="provider" value="<%= s.provider %>">
                  <input type="hidden" name="book_id" value="<%= s.book_id %>">
                  <button class="btn ghost" type="submit">Delete</button>
                </form>
              </div>
            </article>
          <% }) %>
        </div>
      <% } %>
    </section>

    <!-- Notes -->
    <section class="stack" style="--gap:12px;">
      <h2>Your Notes</h2>
      <% if (!notes || !notes.length) { %>
        <div class="card" style="padding:16px;">No notes yet.</div>
      <% } else { %>
        <div class="stack" style="--gap:10px;">
          <% notes.forEach(n => { %>
            <article class="card" style="padding:12px;">
              <div class="row" style="justify-content:space-between;align-items:center;">
                <div class="stack" style="--gap:6px;">
                  <div class="muted" style="font-size:.9rem;">
                    <a href="/read/<%= n.provider %>/<%= n.book_id %>"><%= n.provider %>:<%= n.book_id %></a>
                  </div>
                  <div><%= n.text %></div>
                </div>
                <form method="post" action="/library/notes/delete" class="inline">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <input type="hidden" name="id" value="<%= n.id %>">
                  <button class="btn ghost" type="submit">Delete</button>
                </form>
              </div>
            </article>
          <% }) %>
        </div>
      <% } %>
    </section>

    <form method="post" action="/logout">
      <button class="btn">Logout</button>
    </form>
  </main>

  <%- include('./partials/footer') %>
</body>
</html>
