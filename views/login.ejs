<%
// Guard all locals - prevent crashes
const error = (typeof locals.error !== 'undefined') ? locals.error : null;
const message = (typeof locals.message !== 'undefined') ? locals.message : null;
const messages = (typeof locals.messages !== 'undefined') ? locals.messages : {};
const next = (typeof locals.next !== 'undefined') ? locals.next : '';
const email = (typeof locals.email !== 'undefined') ? locals.email : '';
%>
<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head.ejs', {
    pageTitle: 'Login - BookLantern',
    pageDescription: 'Sign in to your BookLantern account to access your reading history and favorites.'
  }) %>
</head>
<body data-page="auth">
  <%- include('./partials/navbar.ejs') %>

  <main class="content-section">
    <div class="container">
      <%- include('./partials/backLink.ejs', { text: 'Back', fallback: '/' }) %>
      
      <div class="auth-card">
        <div class="auth-header">
          <h1 class="auth-title">Welcome back</h1>
          <p class="auth-subtitle">Sign in to continue to BookLantern</p>
        </div>

        <% if (next) { %>
          <div class="alert info">After you sign in, we'll take you back to what you were doing.</div>
        <% } %>

        <% if (error) { %>
          <div class="alert error"><%= error %></div>
        <% } %>
        <% if (message) { %>
          <div class="alert success"><%= message %></div>
        <% } %>
        <% if (messages.error) { %>
          <div class="alert error"><%= messages.error %></div>
        <% } %>
        <% if (messages.success) { %>
          <div class="alert success"><%= messages.success %></div>
        <% } %>

        <form action="/login" method="POST" class="auth-form">
          <!-- carry next destination (e.g., clicked book) -->
          <% if (next) { %>
            <input type="hidden" name="next" value="<%= next %>">
          <% } %>

          <div class="form-group">
            <label for="email" class="form-label">Email address</label>
            <input
              type="email"
              id="email"
              name="email"
              class="form-input"
              value="<%= email %>"
              required
              autocomplete="email"
              placeholder="your@email.com"
            />
          </div>

          <div class="form-group">
            <label for="password" class="form-label">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              class="form-input"
              required
              autocomplete="current-password"
              placeholder="Enter your password"
            />
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="remember" name="remember" value="true" class="checkbox">
            <label for="remember" class="checkbox-label">Remember me</label>
          </div>

          <button type="submit" class="btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
              <polyline points="10,17 15,12 10,7"></polyline>
              <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
            Sign In
          </button>
        </form>

        <div class="auth-links">
          <p><a href="/forgot-password">Forgot your password?</a></p>
          <p>Don't have an account? <a href="/register<%= next ? ('?next=' + encodeURIComponent(next)) : '' %>">Create one here</a></p>
        </div>
      </div>
    </div>
  </main>

  <%- include('./partials/footer.ejs') %>
</body>
</html>