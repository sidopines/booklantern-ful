<%- include('./partials/head', { pageTitle: 'Login – BookLantern' }) %>
<body>
  <%- include('./partials/navbar') %>
  <%- include('./partials/backLink') %>

  <main class="stack" style="--gap:20px; max-width:560px; margin:40px auto; padding:0 16px;">
    <h1>Login</h1>

    <% if (typeof error !== 'undefined' && error) { %>
      <p class="alert error"><%= error %></p>
    <% } %>
    <% if (typeof success !== 'undefined' && success) { %>
      <p class="alert success"><%= success %></p>
    <% } %>

    <form method="post" action="/login" class="card stack" style="--gap:14px; padding:18px;">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <input type="hidden" name="next" value="<%= typeof next !== 'undefined' ? next : '/' %>">

      <label class="stack" style="--gap:6px;">
        <span>Email</span>
        <input name="email" type="email" required placeholder="you@example.com" autocomplete="email" />
      </label>

      <label class="stack" style="--gap:6px;">
        <span>Password</span>
        <div style="display:flex; align-items:center; gap:8px;">
          <input id="password" name="password" type="password" required placeholder="••••••••" autocomplete="current-password" style="flex:1;" />
          <button type="button" id="togglePw" class="btn" style="min-width:80px;">Show</button>
        </div>
      </label>

      <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:8px;">
        <label style="display:flex; align-items:center; gap:8px;">
          <input type="checkbox" name="remember" value="1" />
          <span>Remember me</span>
        </label>
        <a class="muted" href="/forgot">Forgot password?</a>
      </div>

      <button class="btn btn-primary" type="submit">Login</button>

      <div class="muted" style="text-align:center;">No account? <a href="/register">Create one</a></div>

      <div class="divider" style="display:flex; align-items:center; gap:12px; color:var(--muted);">
        <hr style="flex:1; border:none; border-top:1px solid var(--border);" />
        <span>or</span>
        <hr style="flex:1; border:none; border-top:1px solid var(--border);" />
      </div>

      <!-- OAuth stubs: we’ll wire /auth/google and /auth/apple in server.js next -->
      <div class="stack" style="--gap:10px;">
        <a class="btn" style="width:100%;" href="/auth/google">Continue with Google</a>
        <a class="btn" style="width:100%;" href="/auth/apple">Continue with Apple</a>
      </div>
    </form>
  </main>

  <%- include('./partials/footer') %>

  <script>
    // Show/Hide password toggle
    (function () {
      var btn = document.getElementById('togglePw');
      var pw  = document.getElementById('password');
      if (btn && pw) {
        btn.addEventListener('click', function () {
          var isPwd = pw.getAttribute('type') === 'password';
          pw.setAttribute('type', isPwd ? 'text' : 'password');
          btn.textContent = isPwd ? 'Hide' : 'Show';
        });
      }
    })();
  </script>
</body>
</html>
