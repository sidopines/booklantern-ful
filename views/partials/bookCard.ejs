<%
// Book card with cover, source badge, title, author, and CTA
const book = locals.book || {};
const title = book.title || 'Untitled';
const author = book.author || 'Unknown Author';
const cover = book.cover || '/img/cover-fallback.svg';
const source = book.source || '';
const readUrl = book.readUrl || book.url || '#';

// Source display names
const sourceNames = {
  'gutenberg': 'Gutenberg',
  'openlibrary': 'Open Library', 
  'archive': 'Internet Archive',
  'hathitrust': 'HathiTrust',
  'loc': 'Library of Congress',
  'wikisource': 'Wikisource'
};
const sourceName = sourceNames[source] || source;

// Auth check for read link
let finalReadUrl = readUrl;
if (typeof user === 'undefined' || !user) {
  finalReadUrl = `/login?next=${encodeURIComponent(readUrl)}`;
}
%>

<article class="card hover">
  <div class="book-cover">
    <% if (cover) { %>
      <img src="<%= cover %>" alt="<%= title %> cover" loading="lazy">
    <% } %>
    <% if (sourceName) { %>
      <span class="badge"><%= sourceName %></span>
    <% } %>
  </div>
  
  <div class="book-info">
    <h3 class="book-title"><%= title %></h3>
    <p class="book-author"><%= author %></p>
    
    <a href="<%= finalReadUrl %>" class="btn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
      </svg>
      Read
    </a>
  </div>
</article>

<style>
/* Book card specific styles */
.book-cover {
  position: relative;
  aspect-ratio: 3/4;
  margin-bottom: 12px;
}

.book-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 12px;
}

.book-info {
  padding: 0 4px;
}

.book-info .btn {
  width: 100%;
  margin-top: 12px;
  height: 40px;
  gap: 8px;
}

.book-title {
  font-size: 16px;
  margin: 0 0 4px 0;
  line-height: 1.3;
}

.book-author {
  margin: 0 0 12px 0;
  font-size: 14px;
}
</style>