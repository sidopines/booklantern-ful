<%
  // Defensive guards
  const list = Array.isArray(items) ? items : [];
  const sc = (typeof sectionClass !== 'undefined' && sectionClass) ? sectionClass : '';
  const _title = (typeof title !== 'undefined' && title) ? title : 'Books';
  const _loggedIn = (typeof loggedIn !== 'undefined') ? loggedIn : false;

  // Deterministic id from title for a11y / controls (spaces -> dashes)
  const uid = ('sec-' + _title).replace(/\s+/g, '-').replace(/[^a-zA-Z0-9\-]/g, '').toLowerCase();
%>

<section class="shelf <%= sc %>" aria-labelledby="<%= uid %>-label">
  <div class="shelf-head">
    <h2 id="<%= uid %>-label" class="shelf-title"><%= _title %></h2>

    <!-- Prev/Next controls (JS hooks in /public/js/ui.js) -->
    <div class="shelf-controls" role="group" aria-label="<%= _title %> navigation">
      <button class="carousel-btn prev" data-target="#<%= uid %>" aria-label="Scroll <%= _title %> left">‹</button>
      <button class="carousel-btn next" data-target="#<%= uid %>" aria-label="Scroll <%= _title %> right">›</button>
    </div>
  </div>

  <div id="<%= uid %>" class="carousel-track" role="list" aria-label="<%= _title %>">
    <% if (!list.length) { %>
      <div class="card empty" role="listitem">Nothing here yet.</div>
    <% } else { %>
      <% list.forEach(function(it){ %>
        <%- include('./bookCard', { item: it, loggedIn: _loggedIn }) %>
      <% }) %>
    <% } %>
  </div>
</section>
