<!-- views/partials/nav.ejs - Everand-style Sticky Header -->
<header class="everand-header" id="main-header">
  <div class="container">
    <div class="header-content">
      <!-- Logo/Brand -->
      <a href="/" class="header-logo">
        <img src="/img/brand.svg" alt="BookLantern" width="32" height="32">
        BookLantern
      </a>

      <!-- Search (Desktop) -->
      <div class="header-search">
        <form action="/read" method="GET" class="header-search-form">
          <svg class="header-search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input
            type="text"
            name="query"
            class="header-search-input"
            placeholder="Search books, authors, topics..."
            aria-label="Search books"
          >
        </form>
      </div>

      <!-- Navigation Links (Desktop) -->
      <nav class="header-nav" aria-label="Primary navigation">
        <a href="/read" class="header-nav-link">Read</a>
        <a href="/watch" class="header-nav-link">Watch</a>
        <a href="/about" class="header-nav-link">About</a>
        <a href="/contact" class="header-nav-link">Contact</a>
        
        <% if (user) { %>
          <a href="/dashboard" class="header-nav-link">Dashboard</a>
          <% if (user.isAdmin) { %>
            <a href="/admin" class="header-nav-link">Admin</a>
          <% } %>
          <a href="/logout" class="header-nav-link">Logout</a>
        <% } else { %>
          <a href="/login" class="header-nav-link">Login</a>
          <a href="/register" class="header-nav-link btn-primary">Register</a>
        <% } %>
      </nav>

      <!-- Mobile Menu Toggle -->
      <button class="header-mobile-toggle" aria-label="Toggle menu" aria-expanded="false" id="mobile-toggle">
        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div class="header-mobile-menu" id="mobile-menu">
      <div class="header-mobile-content">
        <!-- Mobile Search -->
        <div class="header-mobile-search">
          <form action="/read" method="GET" class="header-search-form">
            <svg class="header-search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
              type="text"
              name="query"
              class="header-search-input"
              placeholder="Search books, authors, topics..."
              aria-label="Search books"
            >
          </form>
        </div>

        <!-- Mobile Navigation -->
        <nav class="header-mobile-nav" aria-label="Mobile navigation">
          <a href="/read" class="header-nav-link">Read</a>
          <a href="/watch" class="header-nav-link">Watch</a>
          <a href="/about" class="header-nav-link">About</a>
          <a href="/contact" class="header-nav-link">Contact</a>
          
          <% if (user) { %>
            <a href="/dashboard" class="header-nav-link">Dashboard</a>
            <% if (user.isAdmin) { %>
              <a href="/admin" class="header-nav-link">Admin</a>
            <% } %>
            <a href="/logout" class="header-nav-link">Logout</a>
          <% } else { %>
            <a href="/login" class="header-nav-link">Login</a>
            <a href="/register" class="header-nav-link btn-primary">Register</a>
          <% } %>
        </nav>
      </div>
    </div>
  </div>
</header>

<script>
// Header scroll shadow
document.addEventListener('DOMContentLoaded', function() {
  const header = document.getElementById('main-header');
  const mobileToggle = document.getElementById('mobile-toggle');
  const mobileMenu = document.getElementById('mobile-menu');

  // Add scroll shadow to header
  function handleScroll() {
    if (window.scrollY > 10) {
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }
  }

  window.addEventListener('scroll', handleScroll);

  // Mobile menu toggle
  if (mobileToggle && mobileMenu) {
    mobileToggle.addEventListener('click', function() {
      const isExpanded = mobileToggle.getAttribute('aria-expanded') === 'true';
      mobileToggle.setAttribute('aria-expanded', !isExpanded);
      mobileMenu.classList.toggle('open');
    });

    // Close on outside click
    document.addEventListener('click', function(e) {
      if (!header.contains(e.target)) {
        mobileToggle.setAttribute('aria-expanded', 'false');
        mobileMenu.classList.remove('open');
      }
    });

    // Close on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        mobileToggle.setAttribute('aria-expanded', 'false');
        mobileMenu.classList.remove('open');
      }
    });
  }

  // Set active nav link based on current page
  const currentPath = window.location.pathname;
  const navLinks = document.querySelectorAll('.header-nav-link');
  
  navLinks.forEach(link => {
    if (link.getAttribute('href') === currentPath) {
      link.classList.add('active');
    }
  });
});
</script>