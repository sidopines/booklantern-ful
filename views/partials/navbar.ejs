<nav class="nav">
  <div class="nav__inner container">
    <!-- Brand -->
    <a class="brand" href="/">
      <img class="brand__icon" src="/public/logo.svg" alt="BookLantern" width="56" height="56" />
      <span class="brand__wordmark">BookLantern</span>
    </a>

    <!-- Primary links -->
    <ul class="nav__links">
      <li><a href="/read">Read</a></li>
      <li><a href="/watch">Watch</a></li>
      <li><a href="/about">About</a></li>
      <li><a href="/contact">Contact</a></li>
    </ul>

    <!-- Search + actions -->
    <div class="nav__actions">
      <form class="nav__search" action="/search" method="get" role="search">
        <input
          class="input"
          type="search"
          name="q"
          placeholder="Search free books…"
          aria-label="Search free books"
          value="<%= typeof q !== 'undefined' ? q : '' %>"
        />
        <button class="btn btn--dark" type="submit">Search</button>
      </form>

      <!-- Theme toggle -->
      <button class="btn btn--ghost nav__theme" id="themeToggle" type="button" aria-label="Toggle theme">🌙</button>

      <!-- Auth -->
      <% if (isAuthenticated) { %>
        <a class="btn btn--ghost" href="/dashboard">Account</a>
        <form method="post" action="/logout" style="display:inline;">
          <button class="btn" type="submit">Logout</button>
        </form>
      <% } else { %>
        <a class="btn btn--ghost" href="/login">Login</a>
        <a class="btn btn--grad" href="/register">Create<br class="hide-md"> account</a>
      <% } %>
    </div>
  </div>
</nav>

<script>
  // Theme toggle (persists to localStorage)
  (function () {
    const KEY = 'bl-theme';
    const btn = document.getElementById('themeToggle');
    function apply(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      if (btn) btn.textContent = theme === 'dark' ? '☀️' : '🌙';
    }
    let saved = localStorage.getItem(KEY);
    if (!saved) {
      saved = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    apply(saved);
    if (btn) {
      btn.addEventListener('click', () => {
        const next = (document.documentElement.getAttribute('data-theme') === 'dark') ? 'light' : 'dark';
        localStorage.setItem(KEY, next);
        apply(next);
      });
    }
  })();
</script>
