<!-- views/partials/navbar.ejs -->
<header class="nav-wrap">
  <div class="container">
    <nav class="navbar" aria-label="Primary">
      <a class="brand" href="/" aria-label="BookLantern â€” Home">
        <img src="/img/brand.svg" alt="" width="24" height="24" decoding="async" fetchpriority="high" style="vertical-align:middle;margin-right:8px" />
        BookLantern
      </a>

      <button type="button" class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false" aria-controls="nav-links">
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
      </button>

      <ul id="nav-links" class="links">
        <li><a href="/">Home</a></li>
        <li><a href="/read">Read</a></li>
        <li><a href="/watch">Watch</a></li>
        <li class="sep" aria-hidden="true"></li>
        <li><a href="/about">About</a></li>
        <li><a href="/contact">Contact</a></li>

        <% if (user) { %>
          <% if (user.isAdmin) { %>
            <li class="sep" aria-hidden="true"></li>
            <li><a href="/admin">Admin</a></li>
          <% } %>
          <li><a href="/dashboard">Dashboard</a></li>
          <li><a href="/logout" class="btn small alt">Logout</a></li>
        <% } else { %>
          <li class="sep" aria-hidden="true"></li>
          <li><a href="/login" class="btn small alt">Login</a></li>
          <li><a href="/register" class="btn small">Register</a></li>
        <% } %>
      </ul>
    </nav>
  </div>
</header>

<script>
  (function () {
    const btn   = document.querySelector('.nav-toggle');
    const list  = document.getElementById('nav-links');

    if (!btn || !list) return;

    function setOpen(open) {
      list.classList.toggle('open', open);
      btn.setAttribute('aria-expanded', open ? 'true' : 'false');
    }

    // Toggle on button click
    btn.addEventListener('click', () => setOpen(!list.classList.contains('open')));

    // Close when clicking a link (useful on mobile)
    list.addEventListener('click', (e) => {
      if (e.target.tagName === 'A') setOpen(false);
    });

    // Close on outside click
    document.addEventListener('click', (e) => {
      if (!list.classList.contains('open')) return;
      const within = e.target.closest('.navbar');
      if (!within) setOpen(false);
    });

    // Close on Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') setOpen(false);
    });

    // If window is resized to desktop, ensure menu is reset
    let lastW = window.innerWidth;
    window.addEventListener('resize', () => {
      const w = window.innerWidth;
      if (w !== lastW && w >= 900) setOpen(false);
      lastW = w;
    });
  })();
</script>
