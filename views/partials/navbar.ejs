<!-- views/partials/navbar.ejs -->
<nav class="site-nav">
  <div class="nav-inner">
    <a class="brand" href="/">
      <img src="/public/logo.svg" alt="BookLantern" width="36" height="36" />
      <span class="wordmark">BookLantern</span>
    </a>

    <ul class="nav-links">
      <li><a href="/read">Read</a></li>
      <li><a href="/watch">Watch</a></li>
      <li><a href="/about">About</a></li>
      <li><a href="/contact">Contact</a></li>
    </ul>

    <form class="nav-search" action="/search" method="get">
      <input type="text" name="q" placeholder="Search free books..." aria-label="Search" />
      <button class="btn btn--ghost" type="submit">Search</button>
    </form>

    <div class="nav-actions">
      <!-- single theme toggle button -->
      <button id="themeToggle" class="btn btn--ghost" type="button" aria-label="Toggle theme">
        <span id="themeIcon">ðŸŒ™</span>
      </button>

      <% 
        // Be defensive: compute auth state locally so this partial never throws.
        const _user   = (typeof user !== 'undefined' && user) ? user : null;
        const _authed = (typeof isAuthenticated !== 'undefined') ? !!isAuthenticated 
                       : !!(_user && (_user.id || _user.email));
      %>

      <% if (_authed) { %>
        <a class="btn btn--ghost" href="/dashboard">Account</a>
        <form method="post" action="/logout" style="display:inline;">
          <button class="btn btn--primary" type="submit">Logout</button>
        </form>
      <% } else { %>
        <a class="btn btn--ghost" href="/login">Login</a>
        <a class="btn btn--primary" href="/register">Create account</a>
      <% } %>
    </div>
  </div>
</nav>
