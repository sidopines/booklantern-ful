<nav class="nav">
  <div class="nav__inner container">
    <!-- Brand -->
    <a class="brand" href="/" aria-label="BookLantern home">
      <img class="brand__icon" src="/public/logo.svg" alt="" width="64" height="64" />
      <span class="brand__wordmark">BookLantern</span>
    </a>

    <!-- Primary links -->
    <ul class="nav__links" aria-label="Primary">
      <li><a href="/read">Read</a></li>
      <li><a href="/watch">Watch</a></li>
      <li><a href="/about">About</a></li>
      <li><a href="/contact">Contact</a></li>
    </ul>

    <!-- Search -->
    <form class="nav__search" action="/search" method="get" role="search">
      <input
        class="input"
        type="search"
        name="q"
        placeholder="Search free books…"
        aria-label="Search free books"
        value="<%= typeof q !== 'undefined' ? q : '' %>"
      />
      <button class="btn btn--dark" type="submit">Search</button>
    </form>

    <!-- Actions (theme + auth) -->
    <div class="nav__actions">
      <button class="btn btn--ghost nav__theme" id="themeToggle" type="button" aria-label="Toggle theme">
        <span id="themeGlyph" aria-hidden="true">🌙</span>
      </button>

      <% if (isAuthenticated) { %>
        <a class="btn btn--ghost" href="/dashboard">Account</a>
        <form method="post" action="/logout" style="display:inline;">
          <button class="btn" type="submit">Logout</button>
        </form>
      <% } else { %>
        <a class="btn btn--ghost" href="/login">Login</a>
        <a class="btn btn--grad" href="/register">Create<br class="hide-md"> account</a>
      <% } %>
    </div>
  </div>
</nav>

<script>
  // Robust theme toggle: reads/writes localStorage and updates emoji immediately.
  (function () {
    const KEY = 'bl-theme';
    const root = document.documentElement;
    const btn  = document.getElementById('themeToggle');
    const glyph= document.getElementById('themeGlyph');

    function setTheme(t) {
      root.setAttribute('data-theme', t);
      if (glyph) glyph.textContent = t === 'dark' ? '☀️' : '🌙';
    }

    // Initial theme: saved -> attribute -> media query -> light
    let theme = localStorage.getItem(KEY)
             || root.getAttribute('data-theme')
             || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

    setTheme(theme);

    btn && btn.addEventListener('click', () => {
      theme = (root.getAttribute('data-theme') === 'dark') ? 'light' : 'dark';
      localStorage.setItem(KEY, theme);
      setTheme(theme);
    });
  })();
</script>
