<%
  // views/player.ejs
  pageTitle = `${video.title} | Watch`;
  pageDescription = video.description || `Watch "${video.title}" on BookLantern.`;

  const m = (video.youtubeUrl || '').match(/(?:v=|youtu\.be\/|embed\/|shorts\/)([A-Za-z0-9_-]{11})/);
  const ytId = m ? m[1] : null;
%>
<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head.ejs', { pageTitle, pageDescription }) %>
  <style>
    body{ font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:#0e0e0e; color:#fff; margin:0; }
    .container{ max-width:1000px; margin:0 auto; padding:2rem; }
    .back-link{ display:inline-block; margin-bottom:1.5rem; color:#00aced; font-size:.9rem; text-decoration:none; }
    .back-link:hover{ text-decoration:underline; }
    h1{ font-size:2rem; margin:0 0 .5rem; }
    .meta{ color:#aaa; font-size:.9rem; margin-bottom:1.5rem; }
    .video-wrap{ position:relative; width:100%; padding-top:56.25%; border-radius:8px; overflow:hidden; background:#000; }
    .video-wrap iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }
    .msg{ background:#1b1b1b; border:1px solid #333; padding:1rem; border-radius:8px; }
    .description{ font-size:1rem; line-height:1.6; white-space:pre-wrap; margin-top:1.5rem; color:#ddd; }
  </style>
</head>
<body>
  <div class="container">
    <a href="javascript:history.back()" class="back-link">← Back to Watch</a>
    <h1><%= video.title %></h1>
    <div class="meta">
      Genre: <%= (video.genre && video.genre.name) ? video.genre.name : 'Uncategorized' %>
    </div>

    <% if (ytId) { %>
      <div class="video-wrap">
        <iframe
          src="https://www.youtube.com/embed/<%= ytId %>?rel=0"
          title="<%= video.title %>"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen></iframe>
      </div>
    <% } else { %>
      <div class="msg">
        <p>We couldn’t generate an embed from this URL.</p>
        <p><a href="<%= video.youtubeUrl %>" target="_blank" rel="noopener" style="color:#9cd3ff">Open this video on YouTube ↗</a></p>
      </div>
    <% } %>

    <div class="description"><%= video.description || '' %></div>
  </div>
</body>
</html>
