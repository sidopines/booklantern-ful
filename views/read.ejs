<%
const loggedIn = (typeof user !== 'undefined' && user) ? true : false;
const query = (typeof q !== 'undefined' && q) ? q : '';
const books = (typeof results !== 'undefined' && results) ? results : [];
%>
<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head') %>
</head>
<body>
  <%- include('./partials/navbar') %>
  
  <div class="container" style="padding-top:16px">
    <%- include('./partials/backLink') %>
  </div>

  <section class="hero">
    <div class="container stack" style="--gap:16px">
      <% if (query) { %>
        <h1>Search Results</h1>
        <p class="muted">Found <%= books.length %> books for "<%= query %>"</p>
      <% } else { %>
        <h1>Explore Free Books</h1>
        <p class="muted">Millions of books from globally trusted libraries. One search, one clean reader.</p>
      <% } %>
      <form class="search" action="/read" method="get" role="search">
        <input class="input" type="search" name="q" placeholder="Search millions of booksâ€¦" value="<%= query %>">
        <button class="btn" type="submit">Search</button>
      </form>
    </div>
  </section>

  <main class="container" style="padding:40px 0">
    <% if (books && books.length) { %>
      <div class="grid cols-4">
        <% books.forEach(book => { 
          const item = {
            title: book.title || 'Untitled',
            author: book.author || book.creator || '',
            cover: book.cover,
            coverLarge: book.coverLarge,
            image: book.image,
            isbn: book.isbn,
            openLibraryId: book.openLibraryId,
            href: book.href || book.readerUrl || '#',
            description: book.description || book.snippet
          };
        %>
          <%- include('./partials/bookCard', { item }) %>
        <% }) %>
      </div>
    <% } else { %>
      <div class="card" style="text-align:center;padding:40px">
        <% if (query) { %>
          <h3>No results found</h3>
          <p class="muted">Try a different search term or browse all books.</p>
        <% } else { %>
          <p class="muted">Start by searching above.</p>
        <% } %>
      </div>
    <% } %>
  </main>

  <%- include('./partials/footer') %>
</body>
</html>