<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/header'); %>
  <title>Read â€¢ BookLantern</title>
  <style>
    .reader-shell { max-width: 980px; margin: 24px auto 64px; }
    .reader-pane { border:1px solid #eee; border-radius:12px; padding:12px; min-height: 420px; background:#fff; }
    .reader-muted { color:#666; font-size: 14px; }
    .reader-row { display:flex; gap:16px; }
    .reader-row > * { flex:1; }
  </style>
</head>
<body>
  <%- include('partials/navbar'); %>

  <main class="reader-shell">
    <h1 class="page-title">Read</h1>

    <%
      const providerSafe = typeof provider === 'string' ? provider : '';
      const idSafe = typeof id === 'string' ? id : '';
    %>

    <% if (!providerSafe || !idSafe) { %>
      <p class="reader-muted">
        Open a book from the homepage or pass parameters like:
        <code>/read?provider=gutenberg&id=1342</code>.
      </p>
      <div class="reader-pane"></div>
    <% } else { %>
      <div class="reader-row">
        <section class="reader-pane" id="reader"></section>
        <aside class="reader-pane" id="notes"></aside>
      </div>
    <% } %>
  </main>

  <%- include('partials/footer'); %>

  <script>
  (async function () {
    const provider = "<%= providerSafe || '' %>";
    const id = "<%= idSafe || '' %>";
    if (!provider || !id) return;

    const KEY_POS   = `bl:pos:${provider}:${id}`;
    const KEY_NOTES = `bl:notes:${provider}:${id}`;

    try {
      const res = await fetch(`/api/book?provider=${encodeURIComponent(provider)}&id=${encodeURIComponent(id)}`);
      if (!res.ok) throw new Error('Book not found');
      const book = await res.json();
      document.getElementById('reader').textContent = book.title || 'Loaded.';
    } catch (e) {
      document.getElementById('reader').textContent = 'Failed to load book.';
    }
  })();
  </script>
</body>
</html>
