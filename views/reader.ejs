<!doctype html><!doctype html>

<html lang="en"><html>

<head><head>

  <meta charset="utf-8" />  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />  <title><%= (book && book.title) ? book.title : 'Reader' %> ‚Ä¢ Reader</title>

  <meta name="robots" content="noindex, nofollow" />  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title><%= book.title %> - Reader</title>  <style>

  <link rel="stylesheet" href="/public/css/reader.css" />    html,body { height:100%; margin:0; }

</head>    #viewer { height: 100vh; }

<body>    .bar { padding: 10px; display:flex; gap:10px; align-items:center; border-bottom:1px solid #eee; }

  <div class="reader-container">    .bar .title { font-weight:600; }

    <header class="reader-header">  </style>

      <div class="header-left"></head>

        <button id="back-btn" onclick="window.location.href='/library'">‚Üê Back</button><body>

        <span class="book-title"><%= book.title %></span>  <div class="bar">

      </div>    <span class="title"><%= (book && book.title) || 'Untitled' %></span>

      <div class="header-right">    <span>by <%= (book && book.author) || 'Unknown' %></span>

        <button id="toc-btn" title="Table of Contents">‚ò∞</button>  </div>

        <button id="bookmark-btn" title="Bookmark">üîñ</button>

        <button id="settings-btn" title="Settings">‚öôÔ∏è</button>  <% if (epubUrl) { %>

      </div>    <!-- epub.js in-page reader -->

    </header>    <div id="viewer"></div>

        <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>

    <div class="reader-main">    <script>

      <aside id="sidebar" class="sidebar hidden">      const book = ePub("<%- epubUrl %>");

        <div class="sidebar-header">      const rendition = book.renderTo("viewer", { width: "100%", height: "100%" });

          <h3>Contents</h3>      rendition.display();

          <button id="sidebar-close">√ó</button>      document.addEventListener('keydown', (e) => {

        </div>        if (e.key === 'ArrowRight') rendition.next();

        <div id="toc"></div>        if (e.key === 'ArrowLeft') rendition.prev();

      </aside>      });

          </script>

      <div class="reader-content">  <% } else if (book && book.source_url) { %>

        <div id="viewer"></div>    <!-- Fallback: show the source page inside the site -->

        <div class="reader-controls">    <iframe src="<%- book.source_url %>" id="viewer" frameborder="0"></iframe>

          <button id="prev-btn">‚Üê Prev</button>  <% } else { %>

          <div class="progress">    <p style="padding:20px">No readable source is available for this book yet.</p>

            <span id="progress-text">0%</span>  <% } %>

          </div></body>

          <button id="next-btn">Next ‚Üí</button></html>

        </div>
      </div>
    </div>
    
    <!-- Settings Panel -->
    <div id="settings-panel" class="panel hidden">
      <div class="panel-header">
        <h3>Settings</h3>
        <button class="panel-close">√ó</button>
      </div>
      <div class="panel-content">
        <div class="setting-group">
          <label>Font Size</label>
          <div class="btn-group">
            <button id="font-decrease">A-</button>
            <span id="font-size-display">100%</span>
            <button id="font-increase">A+</button>
          </div>
        </div>
        <div class="setting-group">
          <label>Theme</label>
          <div class="btn-group">
            <button class="theme-btn" data-theme="light">Light</button>
            <button class="theme-btn" data-theme="sepia">Sepia</button>
            <button class="theme-btn active" data-theme="dark">Dark</button>
          </div>
        </div>
        <div class="setting-group">
          <label>Audio</label>
          <button id="listen-btn">üîä Listen</button>
          <button id="stop-listen-btn" class="hidden">‚è∏ Stop</button>
        </div>
        <div class="setting-group">
          <label>Library</label>
          <button id="save-btn">üíæ Save to Library</button>
          <button id="unsave-btn" class="hidden">üóë Remove from Library</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Hidden data -->
  <script>
    window.READER_DATA = {
      token: <%= JSON.stringify(readerToken) %>,
      book: <%= JSON.stringify(book) %>
    };
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>
  <script src="/public/js/reader.js"></script>
</body>
</html>
