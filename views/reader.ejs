<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title><%= (book && book.title) ? book.title : 'Reader' %> â€¢ Reader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html,body { height:100%; margin:0; }
    #viewer { height: 100vh; }
    .bar { padding: 10px; display:flex; gap:10px; align-items:center; border-bottom:1px solid #eee; }
    .bar .title { font-weight:600; }
  </style>
</head>
<body>
  <div class="bar">
    <span class="title"><%= (book && book.title) || 'Untitled' %></span>
    <span>by <%= (book && book.author) || 'Unknown' %></span>
  </div>

  <% if (epubUrl) { %>
    <!-- epub.js in-page reader -->
    <div id="viewer"></div>
    <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>
    <script>
      const book = ePub("<%- epubUrl %>");
      const rendition = book.renderTo("viewer", { width: "100%", height: "100%" });
      rendition.display();
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') rendition.next();
        if (e.key === 'ArrowLeft') rendition.prev();
      });
    </script>
  <% } else if (book && book.source_url) { %>
    <!-- Fallback: show the source page inside the site -->
    <iframe src="<%- book.source_url %>" id="viewer" frameborder="0"></iframe>
  <% } else { %>
    <p style="padding:20px">No readable source is available for this book yet.</p>
  <% } %>
</body>
</html>
