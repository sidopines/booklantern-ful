<!doctype html>
<html lang="en">
<head>
  <%- include('./partials/head', {
    pageTitle: 'Create Account • BookLantern',
    pageDescription: 'Create a free account to sync bookmarks and notes.',
    canonicalUrl: (typeof canonicalUrl !== 'undefined' ? canonicalUrl : '')
  }) %>
</head>
<body>
  <%- include('./partials/navbar') %>
  <main class="container" style="max-width:700px; margin:28px auto; padding:0 16px;">
    <h1>Create account</h1>
    <p class="ink-2">We’ll email a confirmation link.</p>

    <form id="regForm" class="card" style="padding:16px; margin-top:12px;">
      <div class="stack" style="--gap:10px;">
        <input class="input" type="email" id="email" placeholder="you@example.com" required>
        <input class="input" type="password" id="password" placeholder="Create a password (min 6 chars)" required>
        <div class="row" style="gap:8px; flex-wrap:wrap;">
          <button class="btn btn-primary" type="submit">Create account</button>
        </div>
        <div class="row" style="gap:8px; flex-wrap:wrap;">
          <button class="btn" id="google" type="button">Continue with Google</button>
          <button class="btn" id="apple" type="button">Continue with Apple</button>
        </div>
        <div id="msg" class="ink-2"></div>
      </div>
    </form>
  </main>
  <%- include('./partials/footer') %>

  <script>
  (function(){
    const sb = window.supabaseClient;
    const msg = (t)=>{ document.getElementById('msg').textContent = t || ''; };

    document.getElementById('regForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg('');
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const redirectTo = (location.origin || '<%= process.env.SITE_URL || "" %>') + '/auth/callback';
      const { error } = await sb.auth.signUp({ email, password, options: { emailRedirectTo: redirectTo } });
      if (error) return msg(error.message);
      msg('Check your inbox to confirm your email.');
    });

    document.getElementById('google').addEventListener('click', async ()=>{
      const redirectTo = (location.origin || '<%= process.env.SITE_URL || "" %>') + '/auth/callback';
      await sb.auth.signInWithOAuth({ provider: 'google', options: { redirectTo } });
    });
    document.getElementById('apple').addEventListener('click', async ()=>{
      const redirectTo = (location.origin || '<%= process.env.SITE_URL || "" %>') + '/auth/callback';
      await sb.auth.signInWithOAuth({ provider: 'apple', options: { redirectTo } });
    });
  })();
  </script>
</body>
</html>
