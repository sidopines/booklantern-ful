<!doctype html>
<html lang="en">
<head>
  <%- include('./partials/head', {
    pageTitle: 'Watch â€¢ BookLantern',
    pageDescription: 'Curated literary videos and author talks.',
    canonicalUrl: (typeof canonicalUrl !== 'undefined' ? canonicalUrl : '')
  }) %>
</head>
<body>
  <%- include('./partials/navbar') %>

  <!-- Safe back link -->
  <% var __safeRef = (typeof referrer !== 'undefined' ? referrer : null); %>
  <%- include('./partials/backLink', { referrer: __safeRef }) %>

  <main class="stack" style="--gap:16px; max-width:1100px; margin:30px auto; padding:0 16px;">
    <div class="row" style="align-items:baseline; justify-content:space-between; flex-wrap:wrap; gap:12px;">
      <h1 style="margin:0;">Watch</h1>

      <% const G = (Array.isArray(genres) ? genres : []); %>
      <% if (G.length) { %>
        <form method="get" class="row" style="gap:8px;">
          <label class="muted" for="genre">Filter:</label>
          <select id="genre" name="genre" onchange="this.form.submit()" class="input" style="min-width:180px;">
            <option value="">All genres</option>
            <% G.forEach(function(g){ %>
              <option value="<%= g %>" <%= (selectedGenre && selectedGenre === g.toLowerCase()) ? 'selected' : '' %>><%= g %></option>
            <% }) %>
          </select>
          <% if (selectedGenre) { %>
            <a class="btn" href="/watch">Reset</a>
          <% } %>
        </form>
      <% } %>
    </div>

    <% const list = (typeof videos !== 'undefined' && Array.isArray(videos)) ? videos : []; %>
    <% if (!list.length) { %>
      <div class="card" style="padding:16px;">No videos yet. (Add them in Admin.)</div>
    <% } else { %>
      <div class="grid" style="--cols:4; gap:12px;">
        <% list.forEach(v => {
             const href  = v && v.url   ? v.url   : '#';
             const title = v && v.title ? v.title : 'Untitled video';
             const thumb = v && v.thumb ? v.thumb : null;
        %>
          <article class="card" style="overflow:hidden;">
            <a href="<%= href %>" target="_blank" rel="noopener noreferrer" class="stack" style="--gap:8px;">
              <% if (thumb) { %>
                <img src="<%= thumb %>" alt="<%= title %>" loading="lazy"
                     style="width:100%; aspect-ratio:16/9; object-fit:cover;">
              <% } else { %>
                <div style="width:100%; aspect-ratio:16/9; display:flex; align-items:center; justify-content:center; background:var(--surface-2); color:var(--ink-2);">
                  No thumbnail
                </div>
              <% } %>
              <div class="meta" style="padding:8px;">
                <h4 class="title" style="margin:0; font-size:1rem; line-height:1.25; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;"><%= title %></h4>
              </div>
            </a>
          </article>
        <% }) %>
      </div>
    <% } %>
  </main>

  <%- include('./partials/footer') %>
  <script src="/public/js/ui.js?v=<%= typeof buildId !== 'undefined' ? buildId : '' %>"></script>
</body>
</html>
