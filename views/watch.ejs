<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/head', { pageTitle: typeof pageTitle !== 'undefined' ? pageTitle : 'Watch â€” BookLantern' }) %>
</head>
<body>
  <%- include('partials/navbar') %>

  <main class="container page-pad">
    <h1 style="font-weight:800;margin-bottom:16px">Watch</h1>
    <p class="muted" style="margin-bottom:16px;">Curated talks, lectures, and explainers.</p>

    <!-- Filters -->
    <form method="GET" action="/watch" class="card" style="padding:12px;margin-bottom:20px;">
      <label for="genre">Filter by genre</label>
      <select id="genre" name="genre" style="min-width:220px;">
        <option value="">All</option>
        <% (genres || []).forEach(function(g){ %>
          <option value="<%= g.id %>" <%= selectedGenre === g.id ? 'selected' : '' %>><%= g.name %></option>
        <% }) %>
      </select>
      <button class="btn" type="submit" style="margin-left:8px;">Apply</button>
    </form>

    <!-- List -->
    <% if (!videos || !videos.length) { %>
      <div class="card">No videos yet.</div>
    <% } else { %>
      <div class="grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;">
        <% videos.forEach(function(v){ 
             const gtags = (videoGenres && videoGenres[v.id]) ? videoGenres[v.id] : [];
        %>
          <article class="card" style="overflow:hidden;">
            <a href="<%= v.url %>" target="_blank" rel="noopener" style="display:block;">
              <div style="background:#f2f4f8;height:160px;display:flex;align-items:center;justify-content:center;">
                <% if (v.thumb) { %>
                  <img src="<%= v.thumb %>" alt="" style="width:100%;height:160px;object-fit:cover;">
                <% } else { %>
                  <span class="muted">No thumbnail</span>
                <% } %>
              </div>
              <div style="padding:10px;">
                <h3 style="margin:0 0 6px 0;font-size:1rem;"><%= v.title %></h3>
                <% if (v.channel) { %><div class="muted" style="font-size:.9rem;"><%= v.channel %></div><% } %>
                <% if (gtags.length) { %>
                  <div style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap;">
                    <% gtags.forEach(function(t){ %>
                      <span style="font-size:.8rem;background:#eef2ff;border:1px solid #dbeafe;border-radius:999px;padding:2px 8px;"><%= t.name %></span>
                    <% }) %>
                  </div>
                <% } %>
              </div>
            </a>
          </article>
        <% }) %>
      </div>
    <% } %>
  </main>

  <%- include('partials/footer') %>
</body>
</html>
