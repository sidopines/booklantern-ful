<!doctype html>
<html lang="en">
<head>
  <%- include('./partials/head', {
    pageTitle: 'Watch â€¢ BookLantern',
    pageDescription: 'Curated literary videos and author talks.',
    canonicalUrl: (typeof canonicalUrl !== 'undefined' ? canonicalUrl : '')
  }) %>
  <style>
    .filters { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin: 8px 0 12px; }
    .pill {
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px; border:1px solid var(--ink-3, #d1d5db);
      background:#fff; color:inherit; text-decoration:none; font-size:.92rem;
    }
    .pill.active { background:#111; color:#fff; border-color:#111; }
    .pill:hover { filter:brightness(.96); }

    .grid { --cols:4; display:grid; grid-template-columns:repeat(var(--cols), minmax(0,1fr)); gap:12px; }
    @media (max-width: 1100px){ .grid{ --cols:3; } }
    @media (max-width: 800px){ .grid{ --cols:2; } }
    @media (max-width: 520px){ .grid{ --cols:1; } }

    .card { border:1px solid rgba(0,0,0,.08); border-radius:12px; background:var(--surface,#fff); box-shadow:0 8px 28px rgba(0,0,0,.05); }
    .thumb { width:100%; aspect-ratio:16/9; background:var(--surface-2,#f5f5f5); display:flex; align-items:center; justify-content:center; overflow:hidden; border-top-left-radius:12px; border-top-right-radius:12px; }
    .thumb img { width:100%; height:100%; object-fit:cover; display:block; }
    .meta { padding:10px 12px; }
    .title { margin:0; font-size:1rem; line-height:1.25; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .sub { margin:4px 0 0; font-size:.88rem; color:var(--ink-2); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  </style>
</head>
<body>
  <%- include('./partials/navbar') %>

  <!-- Safe back link -->
  <% var __safeRef = (typeof referrer !== 'undefined' ? referrer : null); %>
  <%- include('./partials/backLink', { referrer: __safeRef }) %>

  <main class="stack" style="--gap:16px; max-width:1100px; margin:30px auto; padding:0 16px;">
    <h1>Watch</h1>

    <% const GENRES = Array.isArray(genres) ? genres : []; %>
    <% const ACTIVE = typeof activeGenre !== 'undefined' && activeGenre ? activeGenre : null; %>

    <!-- Filters -->
    <div class="filters">
      <a class="pill <%= !ACTIVE ? 'active' : '' %>" href="/watch">All</a>
      <% GENRES.forEach(g => { %>
        <a class="pill <%= ACTIVE === g.id ? 'active' : '' %>" href="/watch?genre=<%= g.id %>"><%= g.name %></a>
      <% }) %>
    </div>

    <% const list = (typeof videos !== 'undefined' && Array.isArray(videos)) ? videos : []; %>
    <% if (!list.length) { %>
      <div class="card" style="padding:16px;">No videos yet. (Add them in Admin.)</div>
    <% } else { %>
      <div class="grid">
        <% list.forEach(v => { %>
          <article class="card" style="overflow:hidden;">
            <a href="<%= v.url %>" target="_blank" rel="noopener noreferrer" class="stack" style="--gap:8px; text-decoration:none; color:inherit;">
              <div class="thumb">
                <% if (v.thumb) { %>
                  <img src="<%= v.thumb %>" alt="<%= v.title %>" loading="lazy">
                <% } else { %>
                  <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:var(--ink-2);">
                    No thumbnail
                  </div>
                <% } %>
              </div>
              <div class="meta">
                <h4 class="title"><%= v.title %></h4>
                <% if (v.channel) { %><div class="sub"><%= v.channel %></div><% } %>
              </div>
            </a>
          </article>
        <% }) %>
      </div>
    <% } %>
  </main>

  <%- include('./partials/footer') %>
</body>
</html>
