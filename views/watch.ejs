<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/header'); %>
  <title>Watch â€¢ BookLantern</title>
</head>
<body>
  <%- include('partials/nav'); %>

  <main class="container" style="padding:24px 0 64px;">
    <h1 class="page-title">Watch</h1>

    <form method="GET" action="/watch" class="filters" style="display:flex;align-items:center;margin:12px 0 24px;">
      <label for="genre" style="margin-right:8px;">Genre</label>
      <select id="genre" name="genre" class="input">
        <option value="">All</option>
        <%
          const GENRES = Array.isArray(genres) ? genres : [];
          const sel = typeof selectedGenre === 'string' ? selectedGenre : '';
          GENRES.forEach(function(g){
        %>
          <option value="<%= g.id %>" <%= sel === g.id ? 'selected' : '' %>><%= g.name %></option>
        <% }) %>
      </select>
      <button class="btn" type="submit" style="margin-left:8px;">Apply</button>
    </form>

    <section class="grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;">
      <%
        const VIDS = Array.isArray(videos) ? videos : [];
        if (!VIDS.length) {
      %>
        <div class="empty">No videos yet.</div>
      <% } else {
           VIDS.forEach(function(v){ %>
        <article class="card" style="border:1px solid #eee;border-radius:12px;padding:12px;background:#fff;">
          <div class="thumb" style="height:126px;background:#fafafa;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden;">
            <% if (v.thumb) { %>
              <img src="<%= v.thumb %>" alt="" style="max-width:100%;max-height:100%;">
            <% } else { %>
              <img src="/public/img/cover-fallback.svg" alt="" style="width:64px;height:64px;opacity:.6;">
            <% } %>
          </div>
          <h3 style="margin:10px 0 6px;font-size:16px;"><%= v.title %></h3>
          <% if (v.channel) { %><div class="muted">by <%= v.channel %></div><% } %>
          <% if (v.url) { %>
            <a href="<%= v.url %>" class="btn" target="_blank" rel="noopener" style="margin-top:10px;display:inline-block;">Watch</a>
          <% } %>
        </article>
      <% }) } %>
    </section>
  </main>

  <%- include('partials/footer'); %>
</body>
</html>
