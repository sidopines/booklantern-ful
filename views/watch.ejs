<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/header'); %>
  <title>Watch â€¢ BookLantern</title>
</head>
<body>
  <%- include('partials/navbar'); %>

  <main class="container" style="padding:24px 0 64px;">
    <h1 class="page-title">Watch</h1>

    <form method="GET" action="/watch" class="filters" style="display:flex;align-items:center;margin:12px 0 24px;">
      <label for="genre" style="margin-right:8px;">Genre</label>
      <select id="genre" name="genre" class="input">
        <option value="">All</option>
        <%
          const GENRES = Array.isArray(genres) ? genres : [];
          const sel = typeof selectedGenre === 'string' ? selectedGenre : '';
          GENRES.forEach(function(g){
        %>
          <option value="<%= g.id %>" <%= sel === String(g.id) ? 'selected' : '' %>><%= g.name %></option>
        <% }) %>
      </select>
      <button class="btn" type="submit" style="margin-left:8px;">Apply</button>
    </form>

    <section class="grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;">
      <%
        const VIDS = Array.isArray(videos) ? videos : [];
        if (!VIDS.length) {
      %>
        <div class="empty">No videos yet.</div>
      <% } else {
           VIDS.forEach(function(v){ %>
        <article class="card" style="border:1px solid #eee;border-radius:12px;padding:12px;background:#fff;">
          <a href="<%= v.playerHref %>" style="display:block;border-radius:8px;overflow:hidden;background:#000;aspect-ratio:16/9;">
            <% if (v.derivedThumb || v.thumb) { %>
              <img src="<%= v.derivedThumb || v.thumb %>" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">
            <% } else { %>
              <img src="/public/img/cover-fallback.svg" alt="" style="width:64px;height:64px;opacity:.6;margin:32px auto;display:block;">
            <% } %>
          </a>
          <h3 style="margin:10px 0 6px;font-size:16px;"><a href="<%= v.playerHref %>" style="text-decoration:none;color:inherit"><%= v.title %></a></h3>
          <% if (v.channel) { %><div class="muted">by <%= v.channel %></div><% } %>
          <a href="<%= v.playerHref %>" class="btn" style="margin-top:10px;display:inline-block;">Watch</a>
        </article>
      <% }) } %>
    </section>
  </main>

  <%- include('partials/footer'); %>
</body>
</html>
