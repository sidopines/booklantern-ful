<!doctype html>
<html lang="en">
<head>
  <%- include('./partials/head', {
    pageTitle: 'Watch â€” Educational Videos',
    pageDescription: 'Curated, educational videos organized by genre.',
    canonicalUrl: (typeof canonicalUrl !== 'undefined' ? canonicalUrl : '')
  }) %>
</head>
<body>
  <%- include('./partials/navbar') %>

  <main class="container" style="padding:24px 0;">
    <h1>Watch</h1>

    <!-- Filters -->
    <form action="/watch" method="get" class="card" style="padding:12px; margin-bottom:16px; display:flex; align-items:center;">
      <label for="genre" style="margin-right:8px;">Genre:</label>
      <select id="genre" name="genre">
        <%
          const sel = (typeof selectedGenre !== 'undefined' && selectedGenre) ? String(selectedGenre) : '';
        %>
        <option value="">All</option>
        <% (Array.isArray(genres) ? genres : []).forEach(function(g){ 
             const gid = String(g.id || '');
        %>
          <option value="<%= gid %>" <%= sel === gid ? 'selected' : '' %>><%= g.name %></option>
        <% }) %>
      </select>
      <button class="btn" type="submit" style="margin-left:8px;">Apply</button>
    </form>

    <!-- List -->
    <div class="videos-grid">
      <% const LIST = Array.isArray(videos) ? videos : []; %>
      <% if (!LIST.length) { %>
        <div class="card" style="padding:16px;">No videos yet.</div>
      <% } else { %>
        <% LIST.forEach(function(v){ %>
          <article class="video-card card" role="listitem">
            <a href="<%= v.url %>" target="_blank" rel="noopener">
              <% if (v.thumb) { %>
                <img src="<%= v.thumb %>" alt="" loading="lazy" />
              <% } else { %>
                <div class="thumb-fallback">Video</div>
              <% } %>
              <h3><%= v.title %></h3>
              <% if (v.channel) { %><p class="muted"><%= v.channel %></p><% } %>
            </a>
          </article>
        <% }) %>
      <% } %>
    </div>
  </main>

  <style>
    .videos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 16px;
    }
    .video-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 8px 8px 0 0; }
    .video-card h3 { font-size: 16px; margin: 8px 12px 4px; }
    .video-card .muted { color: #666; margin: 0 12px 12px; font-size: 13px; }
    .thumb-fallback {
      height: 150px; display:flex; align-items:center; justify-content:center;
      background: #eef1f5; border-radius: 8px 8px 0 0; color:#556; font-weight:600;
    }
  </style>

  <%- include('./partials/footer') %>
</body>
</html>
